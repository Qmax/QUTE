AX51 MACRO ASSEMBLER  RTX51_CONFIG                                                          06/25/14 11:19:22 PAGE     1


MACRO ASSEMBLER AX51 V3.07d
OBJECT MODULE PLACED IN .\DP8051\DP8051_Keil_951\Debug\RTX51_config.obj
ASSEMBLER INVOKED BY: C:\Program Files\Cypress\PSoC Creator\3.0\PSoC Creator\import\keil\pk51\9.51\C51\BIN\Ax51.exe .\Ge
                      nerated_Source\PSoC3\RTX51_config.a51 NOCO MACRO DB PR(.\DP8051\DP8051_Keil_951\Debug\RTX51_config
                      .lst) CASE EP INCDIR(.,.\Generated_Source\PSoC3) OJ(.\DP8051\DP8051_Keil_951\Debug\RTX51_config.obj) 

LOC    OBJ             LINE     SOURCE

                          1     ;*******************************************************************************
                          2     ;* FILENAME: RTX51_config.A51
                          3     ;* Version 1.0
                          4     ;*
                          5     ;* DESCRIPTION:
                          6     ;*  Configuration file for RTX51 Tiny Real-Time Operating System (RTOS)
                          7     ;*  for PSoC 3.
                          8     ;*
                          9     ;* NOTE:
                         10     ;*  This file is taken from RTX-51 TINY  Real-Time Operating System Package
                         11     ;*  Copyright KEIL ELEKTRONIK GmbH and Keil Software, Inc. 1991-2002
                         12     ;*  Version 2.02
                         13     ;*
                         14     ;********************************************************************************
                         15     ;* Copyright 2008-2010, Cypress Semiconductor Corporation.  All rights reserved.
                         16     ;* You may use this file only in accordance with the license, terms, conditions, 
                         17     ;* disclaimers, and limitations in the end user license agreement accompanying 
                         18     ;* the software package with which this file was provided.
                         19     ;********************************************************************************
                         20     
                         21     $nomod51 
                         22     
                         23     ;*******************************************************************************
                         24     ;* RTX-51 TINY Scheduling mode
                         25     ;* Configure the RTX51Tiny scheduling mode and Round Robin timeout value
                         26     ;*******************************************************************************
                         27     
                         28     ;* Define the register bank used for the interrupt service routine.
 0001                    29     INT_REGBANK     EQU     1   ; default is Registerbank 1
                         30     
                         31     ;* Define Round-Robin Timeout in clock ticks input to interrupt component.
                         32     IF (1)
 0005                    33     TIMESHARING     EQU     5   ; default is 5 clock ticks.
                                ENDIF
                         37     
                         38     ;*******************************************************************************
                         39     ;* Long User Interrupt Routines: set to 1 if application contains
                         40     ;* user interrupt functions that may take longer than a hardware timer
                         41     ;* interval for execution.
                         42     ;*      0 user interrupts execute fast.
                         43     ;*      1 user interrupts take long execution times.
                         44     ;*******************************************************************************
 0001                    45     LONG_USR_INTR   EQU 1
                         46     
                         47     ;*******************************************************************************
                         48     ;* RTX-51 TINY Stack Space
                         49     ;* The following EQU statements defines the size of the internal RAM used
                         50     ;* for stack area and the minimum free space on the stack.  A macro defines
                         51     ;* the code executed when there is not enough free stack on the CPU stack.
                         52     ;*******************************************************************************
                         53     ;* Define the highest RAM address used for CPU stack
 00FF                    54     RAMTOP      EQU     0FFH    ; default is address (256-1)
                         55     
                                ENDIF
                         59     
                         60     IF (1)
AX51 MACRO ASSEMBLER  RTX51_CONFIG                                                          06/25/14 11:19:22 PAGE     2

                         61     
 0014                    62     FREE_STACK  EQU 20   ; default is 20 bytes free space on stack
                         63     
                         64     STACK_ERROR MACRO
                         65     IF (0)
                         66             lcall 
                         67     ELSE
                         68             clr     EA      ; disable interrupts
                         69             sjmp    $       ; endless loop if stack space is exhausted
                         70     ENDIF
                         71             ENDM
                                ENDIF
                         77     
                         78     ;*******************************************************************************
                         79     ;*
                         80     ;* PSoC 3 CPU IDLE CODE
                         81     ;*
                         82     ;* The following macro defines the code executed when there is no
                         83     ;* ready task in the system.  The code must set the CPU into an IDLE MODE
                         84     ;* that stops instruction execution until an interrupt occurs.
                         85     ;*      0  CPU_IDLE MACRO is not inserted
                         86     ;*      1  CPU_IDLE MACRO is executed
                         87     ;*******************************************************************************
                         88     
                         89     ;* Disable or Enable CPU_IDLE CODE
 0000                    90     CPU_IDLE_CODE   EQU     0
                         91     
                         92     ;* Stop CPU execution until hardware interrupt
                         93     ;* Executed when there is no active task in the system.
                         94     CPU_IDLE    MACRO
                         95             ENDM
                         96     
                         97     ;*******************************************************************************
                         98     ;*                      End of User Configuration Part
                         99     ;*******************************************************************************
                        100     
                        101             ;* SFR Symbols
 00D0                   102             PSW     DATA    0D0H
 00E0                   103             ACC     DATA    0E0H
 00F0                   104             B       DATA    0F0H
 0081                   105             SP      DATA    81H
 0082                   106             DPL     DATA    82H
 0083                   107             DPH     DATA    83H
 00A8                   108             IE      DATA    0A8H
                        109     
                        110             ;* IE
 00A8.7                 111             EA      BIT     0AFH
                        112     
                        113             NAME    ?RTX51_TINY_KERNAL
                        114     
                        115             PUBLIC  ?RTX_CURRENTTASK
                        116             PUBLIC  ?RTX_RAMTOP
                        117             PUBLIC  os_switch_task
                        118             PUBLIC  ?RTX?SET_ISR
                        119             PUBLIC  TIMERINT
                        120     
                        121             EXTRN   NUMBER (?RTX_MAXTASKN)      ; max Task Number
                        122     
 00FF                   123     ?RTX_RAMTOP   EQU   RAMTOP
                        124     
 0008                   125     ?RTX_REGISTERBANK EQU   INT_REGBANK * 8
000008                  126             DSEG  AT  ?RTX_REGISTERBANK
000008                  127             DS    2                 ; temporary space
                        128     
00000A                  129     ?RTX_SAVEACC:       DS    1
  REG                   130     saveacc             EQU   R2    ; for access in interrupt service routine
AX51 MACRO ASSEMBLER  RTX51_CONFIG                                                          06/25/14 11:19:22 PAGE     3

00000B                  131     ?RTX_SAVEPSW:       DS    1
  REG                   132     savepsw             EQU   R3    ; for access in interrupt service routine
00000C                  133     ?RTX_CURRENTTASK:   DS    1
  REG                   134     currenttask         EQU   R4    ; for access in interrupt service routine
                        135     
                        136     IF (TIMESHARING <> 0)
00000D                  137     ?RTX_ROBINTIME:     DS    1
  REG                   138     robintime           EQU   R5    ; for access in interrupt service routine
                        139     ENDIF
                        140     
                        141     ;*******************************************************************************
                        142     ;* Table of Task Entry Pointers
                        143     ;*******************************************************************************
                        144             PUBLIC  ?RTX_TASKENTRY
                        145     
------                  146     ?RTX?TASKENT?S  SEGMENT CODE
------                  147             RSEG    ?RTX?TASKENT?S
000000                  148     ?RTX_TASKENTRY: DS  2
                        149     
                        150     ;*******************************************************************************
                        151     ;* Table of Stack Pointers for each task
                        152     ;*******************************************************************************
                        153             PUBLIC  ?RTX_TASKSP
                        154     
------                  155     ?RTX?TASKSP?S   SEGMENT IDATA
------                  156             RSEG    ?RTX?TASKSP?S
000000                  157     ?RTX_TASKSP:    DS  1
                        158     
                        159     ;*******************************************************************************
                        160     ;* Table of Task Timer/State Pointers
                        161     ;*******************************************************************************
                        162             PUBLIC  ?RTX_TASKSTATUS
                        163     
------                  164     ?RTX?TASKSTATE?S  SEGMENT IDATA
------                  165                 RSEG    ?RTX?TASKSTATE?S
000000                  166     ?RTX_TASKSTATUS:
000000                  167     TimerVal:   DS  1   ; Task Timer (Software Timer for each task)
000001                  168     TaskState:  DS  1   ; Task Status (state of each Task)
                        169     
                        170     ;*******************************************************************************
                        171     ;*  Definitions for Bits in Task State
                        172     ;*  TaskState.0  = Wait for Signal
                        173     ;*  TaskState.1  = Wait for TimeOut
                        174     ;*  TaskState.2  = Signal Flag
                        175     ;*  TaskState.3  = TimeOut Flag
                        176     ;*  TaskState.4  = Task Ready (Wait for Running)
                        177     ;*  TaskState.5  = Task Active (enabled with os_create)
                        178     ;*  TaskState.6  = Round Robin Time Out
                        179     ;*  TaskState.7  = Run Flag
                        180     ;*******************************************************************************
                        181     ;* Byte mask definitions
 0001                   182         K_SIG       EQU     1
 0002                   183         K_TMO       EQU     2
 0004                   184         SIG_EVENT   EQU     4
 0008                   185         TMO_EVENT   EQU     8
 0010                   186         K_READY     EQU     16
 0020                   187         K_ACTIVE    EQU     32
 0040                   188         K_ROBIN     EQU     64
 0080                   189         K_IVL       EQU     128  ; not a task state bit; only used in os_wait
 0080                   190         RDY_EVENT   EQU     128  ; READY status flag
 0080                   191         K_RDY       EQU     128
                        192     
                        193     ;* Bit position definitions
 0000                   194         B_WAITSIG   EQU     0
 0001                   195         B_WAITTIM   EQU     1
 0002                   196         B_SIGNAL    EQU     2
AX51 MACRO ASSEMBLER  RTX51_CONFIG                                                          06/25/14 11:19:22 PAGE     4

 0003                   197         B_TIMEOUT   EQU     3
 0004                   198         B_READY     EQU     4
 0005                   199         B_ACTIVE    EQU     5
 0006                   200         B_ROBIN     EQU     6
 0007                   201         B_IVL       EQU     7    ; not a task state bit; only used in os_wait
 0007                   202         B_RDY       EQU     7
                        203     
                        204     
                        205     IF (TIMESHARING OR CPU_IDLE_CODE)
------                  206     ?RTX?BITS   SEGMENT     BIT
------                  207             RSEG    ?RTX?BITS
                        208     ENDIF
                        209     
                        210     IF (TIMESHARING)
0000.0                  211     ?RTX_TS_DELAY:  DBIT    1   ; Status bit set when task switch in progress
                        212     ENDIF
                        213     
                                ENDIF
                        217     
------                  218     ?RTX?CODE       SEGMENT CODE
------                  219             RSEG    ?RTX?CODE
                        220             USING   0           ; Registerbank 0 for following code
                        221     
                        222     IF (FREE_STACK <> 0)
000000                  223     ?RTX_STACKERROR:
                        224+1           STACK_ERROR         ; User defined Stack Error Code
                        231     ENDIF
                        232     
000004                  233     HW_TIMER:
000004 32               234             reti
                        235     
                        236     ;*******************************************************************************
                        237     ;* void TIMERINT(void)
                        238     ;* This function is called from the interrupt component of RTX51Tiny Component
                        239     ;* This function is responsible for task scheduling.
                        240     ;*******************************************************************************
000005                  241     TIMERINT:
                        242     
                        243     IF (LONG_USR_INTR)
000005 C0E0             244             push    ACC
000007 E5D0             245             mov     A,PSW
000009 5418             246             anl     A,#018H
00000B 6408             247             xrl     A,#?RTX_REGISTERBANK
00000D 7003             248             jnz     CONT_TIMINT
                        249     
                        250     ;* Avoid recursive timer interrupt
00000F D0E0             251             pop     ACC
000011 32               252             reti        ; Return from Recursive Timer Interrupt
                        253     
000012                  254     CONT_TIMINT:
000012 D0E0             255             pop     ACC
                        256     ENDIF
000014 120000     F     257             lcall   HW_TIMER
                        258     
000017 85D000     F     259             mov     ?RTX_SAVEPSW,PSW
00001A 75D008           260             mov     PSW,#?RTX_REGISTERBANK
00001D AAE0             261             mov     saveacc,ACC     ; ACC required by some Cygnal devices
                        262     
                        263     IF (FREE_STACK <> 0)
                        264     ;* Check if enough free stack is available
00001F EC               265             mov     A,currenttask
000020 2400       F     266             add     A,#?RTX?TASKSP?S+1
000022 F8               267             mov     R0,A
000023 E6               268             mov     A,@R0
000024 BC0002           269             cjne    currenttask,#?RTX_MAXTASKN,checkstack
000027 74FF             270             mov     A,#RAMTOP
AX51 MACRO ASSEMBLER  RTX51_CONFIG                                                          06/25/14 11:19:22 PAGE     5

000029                  271     checkstack:
000029 C3               272             clr     C
00002A 9581             273             subb    A,SP
00002C B41400           274             cjne    A,#FREE_STACK,$+3
00002F 40CF             275             jc      ?RTX_STACKERROR
                        276     ENDIF
                        277     
                        278     ;* Update & Check Task Timers
000031 7900       E     279             mov     R1,#?RTX_MAXTASKN+1
000033 7800       F     280             mov     R0,#?RTX?TASKSTATE?S
000035                  281     TIMERLOOP:
000035 16               282             dec     @R0          ; Decrement timer
000036 E6               283             mov     A,@R0
000037 08               284             inc     R0           ; advance to TaskState
000038 700B             285             jnz     NoTimeout
00003A C2AF             286             clr     EA
00003C E6               287             mov     A,@R0
00003D 30E103           288             jnb     ACC.B_WAITTIM,NoWaitTimeout
000040 4418             289             orl     A,#(K_READY+TMO_EVENT)
000042 F6               290             mov     @R0,A
000043                  291     NoWaitTimeout:
000043 D2AF             292             setb    EA
000045                  293     NoTimeout:
000045 08               294             inc     R0           ; advance to TaskTimer
000046 D9ED             295             djnz    R1,TIMERLOOP
                        296     
000048 EA               297             mov     A,saveacc
000049 8BD0             298             mov     PSW,savepsw
                        299             USING   0           ; Registerbank 0 for following code
                        300     
                                ENDIF
                        309     
                        310     IF (TIMESHARING)
                        311     ;* Round Robin Task Switching required.  Check if task generates timeout
                        312     ;* Check for Round Robin Timeout on the current task
00004B 300001           313             jnb     ?RTX_TS_DELAY,CheckRobinTime
00004E                  314     NoRobinTimeout:
00004E                  315     ?RTX?SET_ISR:
                                ENDIF
00004E 22               319             ret
00004F                  320     CheckRobinTime:
00004F D500FC           321             djnz    ?RTX_ROBINTIME,NoRobinTimeout
                        322     
000052                  323     ?RTX_TASKSWITCHING:
000052 C0E0             324             push    ACC
000054 C0D0             325             push    PSW
000056 C0F0             326             push    B
000058 C083             327             push    DPH
00005A C082             328             push    DPL
00005C C000             329             push    AR0
00005E C001             330             push    AR1
000060 C002             331             push    AR2
000062 C003             332             push    AR3
000064 C004             333             push    AR4
000066 C005             334             push    AR5
000068 C006             335             push    AR6
00006A C007             336             push    AR7
                        337     
00006C E500       F     338             mov     A,?RTX_CURRENTTASK
00006E 23               339             rl      A
00006F 2400       F     340             add     A,#?RTX?TASKSTATE?S+1
000071 F8               341             mov     R0,A
000072 7440             342             mov     A,#K_ROBIN
000074 C2AF             343             clr     EA
000076 46               344             orl     A,@R0
000077 F6               345             mov     @R0,A
AX51 MACRO ASSEMBLER  RTX51_CONFIG                                                          06/25/14 11:19:22 PAGE     6

000078 D2AF             346             setb    EA
                        347     ENDIF
                        348     
                        349     ;*******************************************************************************
                        350     ;* void os_switch_task (void)
                        351     ;* Performs a Task-Switch
                        352     ;*
                        353     ;* Variable 'current' assigned to Register 'R6'
                        354     ;* Variable 'next'    assigned to Register 'R7'
                        355     ;* Variable 'i'       assigned to Register 'R0'
                        356     ;* Variable 'limit'   assigned to Register 'R5'
                        357     ;*******************************************************************************
                        358     
00007A                  359     os_switch_task:
00007A                  360     os_switch_task1:
                        361     
                        362     ;*      next = current;
                        363     IF (TIMESHARING <> 0)
00007A D200       F     364             setb    ?RTX_TS_DELAY       ; Delay Task Switching
                        365     ENDIF
00007C E500       F     366             mov     A,?RTX_CURRENTTASK
00007E FF               367             mov     R7,A
                        368     
                        369     ;*      while (1) {
00007F 23               370             rl      A
000080 2400       F     371             add     A,#?RTX?TASKSTATE?S+1
000082 F8               372             mov     R0,A
000083                  373     ?C0001:
                        374     ;*      if (++next == MAXTASKN+1)  next = 0;
000083 0F               375             inc     R7
000084 08               376             inc     R0
000085 08               377             inc     R0
                                ENDIF
000086 BF0004           385             cjne    R7,#?RTX_MAXTASKN+1,?C0003
000089 7F00             386             mov     R7,#0
00008B 7800       F     387             mov     R0,#?RTX?TASKSTATE?S+1
00008D                  388     ?C0003:
                        389     ;*      if (STATE[next].st & K_READY)  break;
00008D E6               390             mov     A,@R0
00008E 30E4F2           391             jnb     ACC.B_READY,?C0001
                        392     ;*      }
                        393     
                        394     PUBLIC  ?RTX_NEXTID
                        395     PUBLIC  ?RTX_NEXTTASK
                        396     
 0007                   397     ?RTX_NEXTID     EQU     AR7
000091                  398     ?RTX_NEXTTASK:
000091 00               399             nop     ; for Debugging
                        400     
                        401     ;*      while (current < next) {
000092                  402     ?C0005:
000092 E500       F     403             mov     A,?RTX_CURRENTTASK
000094 C3               404             clr     C
000095 9F               405             subb    A,R7
000096 5020             406             jnc     ?C0011
                        407     
                        408     ;*      current++;
000098 0500       F     409             inc     ?RTX_CURRENTTASK
                        410     
                        411     ;*      i = STKP[current];
00009A 7400       F     412             mov     A,#?RTX?TASKSP?S
00009C 2500       F     413             add     A,?RTX_CURRENTTASK
00009E F8               414             mov     R0,A
00009F E6               415             mov     A,@R0
0000A0 FD               416             mov     R5,A
                        417     
AX51 MACRO ASSEMBLER  RTX51_CONFIG                                                          06/25/14 11:19:22 PAGE     7

                        418     ;*      STKP[current] = SP;
0000A1 A681             419             mov     @R0,SP
                        420     
                        421     ;*      if (current == MAXTASKN) limit = RAMTOP;
0000A3 08               422             inc     R0
0000A4 E6               423             mov     A,@R0
0000A5 AE00       F     424             mov     R6,?RTX_CURRENTTASK
0000A7 BE0002           425             cjne    R6,#?RTX_MAXTASKN,?C0007
0000AA 74FF             426             mov     A,#RAMTOP
0000AC                  427     ?C0007:
0000AC CD               428             xch     A,R5
0000AD F8               429             mov     R0,A
                        430     
                        431     ;*      else    limit = STKP[current+1];
                        432     ;*      while (i != limit) {
0000AE                  433     ?C0009:
0000AE E8               434             mov     A,R0
0000AF 6D               435             xrl     A,R5
0000B0 60E0             436             jz      ?C0005
                        437     ;*      SP++; i++; STACK[SP] = STACK[i];
0000B2 08               438             inc     R0
0000B3 E6               439             mov     A,@R0
0000B4 C0E0             440             push    ACC
0000B6 80F6             441             sjmp    ?C0009
                        442     ;*      }
                        443     ;*  }
0000B8                  444     ?C0011:
                        445     
                        446     ;*      while (current > next) {
0000B8 E500       F     447             mov     A,?RTX_CURRENTTASK
0000BA D3               448             setb    C
0000BB 9F               449             subb    A,R7
0000BC 4027             450             jc      ?C0012
                        451     
0000BE E500       F     452             mov     A,?RTX_CURRENTTASK
0000C0 2400       F     453             add     A,#?RTX?TASKSP?S+1
0000C2 F8               454             mov     R0,A
0000C3 E6               455             mov     A,@R0
                        456     
                        457     ;*      if (current == (MAXTASKN)) i = RAMTOP;
                        458     ;*      else                       i = STKP[current+1];
0000C4 AE00       F     459             mov     R6,?RTX_CURRENTTASK
0000C6 BE0002           460             cjne    R6,#?RTX_MAXTASKN,?C0013
0000C9 74FF             461             mov     A,#RAMTOP
0000CB                  462     ?C0013:
0000CB FD               463             mov     R5,A
                        464     ;*      limit = STKP[current];
0000CC 18               465             dec     R0
0000CD E6               466             mov     A,@R0
0000CE CD               467             xch     A,R5
0000CF F8               468             mov     R0,A
                        469     
                        470     ;*      while (SP != limit) {
0000D0                  471     ?C0015:
0000D0 E581             472             mov     A,SP
0000D2 6D               473             xrl     A,R5
0000D3 6006             474             jz      ?C0016
                        475     
                        476     ;*      STACK[i] = STACK[SP]; i--; SP--;
0000D5 D0E0             477             pop     ACC
0000D7 F6               478             mov     @R0,A
0000D8 18               479             dec     R0
                        480     
0000D9 80F5             481             sjmp    ?C0015
0000DB                  482     ?C0016:
                        483     ;*      }
AX51 MACRO ASSEMBLER  RTX51_CONFIG                                                          06/25/14 11:19:22 PAGE     8

                        484     ;*      STKP[current] = i;
0000DB E500       F     485             mov     A,?RTX_CURRENTTASK
0000DD 2400       F     486             add     A,#?RTX?TASKSP?S
0000DF C8               487             xch     A,R0
0000E0 F6               488             mov     @R0,A
                        489     
                        490     ;*      current--;
0000E1 1500       F     491             dec     ?RTX_CURRENTTASK
0000E3 80D3             492             sjmp    ?C0011
0000E5                  493     ?C0012:
                        494     ;*  }
                        495     
                        496     ;*      RoundRobinTime = ?RTX_TIMESHARING
                        497     IF (TIMESHARING)
0000E5 750005     F     498             mov     ?RTX_ROBINTIME,#TIMESHARING
                        499     ENDIF
                        500     
                        501     ;*      if (STATE[current].st & K_ROBIN)  goto RobinOn;
0000E8 E500       F     502             mov     A,?RTX_CURRENTTASK
0000EA 23               503             rl      A
0000EB 2400       F     504             add     A,#?RTX?TASKSTATE?S+1
0000ED F8               505             mov     R0,A
0000EE 7F04             506             mov     R7,#SIG_EVENT
0000F0 C2AF             507             clr     EA
0000F2 E6               508             mov     A,@R0
                        509     IF (TIMESHARING)
0000F3 10E61E           510             jbc     ACC.B_ROBIN,RobinOn
                        511     ENDIF
                        512     ;*      if ((STATE[current].st & K_SIG) && (STATE[current].st & SIG_EVENT)
                        513     ;*      goto SignalOn;
0000F6 30E003           514             jnb     ACC.B_WAITSIG,SignalOff
0000F9 10E20C           515             jbc     ACC.B_SIGNAL,SignalOn
                        516     
0000FC                  517     SignalOff:
                        518     ;*      if ((STATE[current].st & K_TMO) && (STATE[current].st & TMO_EVENT)
                        519     ;*      goto TimeOutOn;
0000FC 7F00             520             mov     R7,#0       ; No Event
0000FE 30E107           521             jnb     ACC.B_WAITTIM,NoEvent
000101 30E304           522             jnb     ACC.B_TIMEOUT,NoEvent
000104                  523     TimeOutOn:
000104 7F08             524             mov     R7,#TMO_EVENT
000106 54F4             525             anl     A,#0F4H
000108                  526     SignalOn:
000108                  527     NoEvent:
000108 547C             528             anl     A,#NOT (K_RDY + K_TMO + K_SIG)  ; Clear RDY + Wait bits
00010A C6               529             xch     A,@R0
00010B D2AF             530             setb    EA
                        531     
00010D 5480             532             anl     A,#K_RDY
00010F 4207             533             orl     AR7,A
                        534     IF (TIMESHARING <> 0)
000111 C200       F     535             clr     ?RTX_TS_DELAY
000113 22               536             ret
                                ENDIF
                        540     
                        541     IF (TIMESHARING <> 0)
000114                  542     RobinOn:
000114 F6               543             mov     @R0,A
000115 D2AF             544             setb    EA
                        545     
000117 D007             546             pop     AR7
000119 D006             547             pop     AR6
00011B D005             548             pop     AR5
00011D D004             549             pop     AR4
00011F D003             550             pop     AR3
000121 D002             551             pop     AR2
AX51 MACRO ASSEMBLER  RTX51_CONFIG                                                          06/25/14 11:19:22 PAGE     9

000123 D001             552             pop     AR1
000125 D000             553             pop     AR0
000127 D082             554             pop     DPL
000129 D083             555             pop     DPH
00012B D0F0             556             pop     B
00012D D0D0             557             pop     PSW
00012F D0E0             558             pop     ACC
000131 C200       F     559             clr     ?RTX_TS_DELAY
000133 22               560             ret         ; Restart Task
                        561     ENDIF
                        562     ;*      }
                        563     ;*  }
                        564     
                        565     
                        566     ;*******************************************************************************
                        567     ;* void main(void)
                        568     ;* Start RTX-51 Tiny Kernel
                        569     ;*******************************************************************************
                        570     
                        571             EXTRN CODE (?C_STARTUP)
                        572             PUBLIC  main
                        573     
000134                  574     main:
000134 7800       F     575             mov     R0,#?RTX?TASKSP?S
000136 A681             576             mov     @R0,SP
000138 7400       E     577             mov     A,#?RTX_MAXTASKN
00013A 6006             578             jz      main2
00013C FF               579             mov     R7,A
00013D                  580     main1:
00013D 08               581             inc     R0
00013E 76FF             582             mov     @R0,#RAMTOP
000140 DFFB             583             djnz    R7,main1
000142                  584     main2:
000142 7F00       E     585             mov     R7,#?RTX_MAXTASKN+1
000144 E4               586             clr     A
000145 7800       F     587             mov     R0,#?RTX?TASKSTATE?S
000147                  588     main1x:
000147 F6               589             mov     @R0,A
000148 08               590             inc     R0
000149 F6               591             mov     @R0,A
00014A 08               592             inc     R0
00014B DFFA             593             djnz    R7,main1x
00014D 7800       F     594             mov     R0,#?RTX?TASKSTATE?S+1
00014F 7630             595             mov     @R0,#K_ACTIVE+K_READY
000151 900000     F     596             mov     DPTR,#?RTX?TASKENT?S
000154 7401             597             mov     A,#1
000156 93               598             movc    A,@A+DPTR
000157 C0E0             599             push    ACC
000159 E4               600             clr     A
00015A 93               601             movc    A,@A+DPTR
00015B C0E0             602             push    ACC
                        603     IF (TIMESHARING <> 0)
00015D 750005     F     604             mov     ?RTX_ROBINTIME,#TIMESHARING
                        605     ENDIF
000160 D2AF             606             setb    EA
000162 22               607             ret     ; Start Task 0
                        608     
                        609     ;*******************************************************************************
                        610     ;* For Debugging
                        611     ;*******************************************************************************
                        612     
                        613     PUBLIC ?RTX_TASKIDX
000163 00         E     614     ?RTX_TASKIDX:   DB  ?RTX_MAXTASKN
                        615     
                        616     ;*******************************************************************************
                        617     ;* End of file.
AX51 MACRO ASSEMBLER  RTX51_CONFIG                                                          06/25/14 11:19:22 PAGE    10

                        618     ;*******************************************************************************
                        619             END
AX51 MACRO ASSEMBLER  RTX51_CONFIG                                                          06/25/14 11:19:22 PAGE    11

SYMBOL TABLE LISTING
------ ----- -------


N A M E                    T Y P E  V A L U E     ATTRIBUTES

?C0001. . . . . . . . . .  C  ADDR  0083H     R   SEG=?RTX?CODE
?C0003. . . . . . . . . .  C  ADDR  008DH     R   SEG=?RTX?CODE
?C0005. . . . . . . . . .  C  ADDR  0092H     R   SEG=?RTX?CODE
?C0007. . . . . . . . . .  C  ADDR  00ACH     R   SEG=?RTX?CODE
?C0009. . . . . . . . . .  C  ADDR  00AEH     R   SEG=?RTX?CODE
?C0011. . . . . . . . . .  C  ADDR  00B8H     R   SEG=?RTX?CODE
?C0012. . . . . . . . . .  C  ADDR  00E5H     R   SEG=?RTX?CODE
?C0013. . . . . . . . . .  C  ADDR  00CBH     R   SEG=?RTX?CODE
?C0015. . . . . . . . . .  C  ADDR  00D0H     R   SEG=?RTX?CODE
?C0016. . . . . . . . . .  C  ADDR  00DBH     R   SEG=?RTX?CODE
?C_STARTUP. . . . . . . .  C  ADDR  -------       EXT
?RTX51_TINY_KERNAL. . . .  -- ----  -------       
?RTX?BITS . . . . . . . .  B  SEG   000001H       REL=UNIT, ALN=BIT
?RTX?CODE . . . . . . . .  C  SEG   000164H       REL=UNIT, ALN=BYTE
?RTX?SET_ISR. . . . . . .  C  ADDR  004EH     R   SEG=?RTX?CODE
?RTX?TASKENT?S. . . . . .  C  SEG   000002H       REL=UNIT, ALN=BYTE
?RTX?TASKSP?S . . . . . .  I  SEG   000001H       REL=UNIT, ALN=BYTE
?RTX?TASKSTATE?S. . . . .  I  SEG   000002H       REL=UNIT, ALN=BYTE
?RTX_CURRENTTASK. . . . .  D  ADDR  000CH     R   SEG=?DT?RTX51_CONFIG?1
?RTX_MAXTASKN . . . . . .  N  NUMB  -------       EXT
?RTX_NEXTID . . . . . . .  D  ADDR  0007H     A   
?RTX_NEXTTASK . . . . . .  C  ADDR  0091H     R   SEG=?RTX?CODE
?RTX_RAMTOP . . . . . . .  N  NUMB  00FFH     A   
?RTX_REGISTERBANK . . . .  N  NUMB  0008H     A   
?RTX_ROBINTIME. . . . . .  D  ADDR  000DH     R   SEG=?DT?RTX51_CONFIG?1
?RTX_SAVEACC. . . . . . .  D  ADDR  000AH     R   SEG=?DT?RTX51_CONFIG?1
?RTX_SAVEPSW. . . . . . .  D  ADDR  000BH     R   SEG=?DT?RTX51_CONFIG?1
?RTX_STACKERROR . . . . .  C  ADDR  0000H     R   SEG=?RTX?CODE
?RTX_TASKENTRY. . . . . .  C  ADDR  0000H     R   SEG=?RTX?TASKENT?S
?RTX_TASKIDX. . . . . . .  C  ADDR  0163H     R   SEG=?RTX?CODE
?RTX_TASKSP . . . . . . .  I  ADDR  0000H     R   SEG=?RTX?TASKSP?S
?RTX_TASKSTATUS . . . . .  I  ADDR  0000H     R   SEG=?RTX?TASKSTATE?S
?RTX_TASKSWITCHING. . . .  C  ADDR  0052H     R   SEG=?RTX?CODE
?RTX_TS_DELAY . . . . . .  B  ADDR  0000H.0   R   SEG=?RTX?BITS
ACC . . . . . . . . . . .  D  ADDR  00E0H     A   
AR0 . . . . . . . . . . .  D  ADDR  0000H     A   
AR1 . . . . . . . . . . .  D  ADDR  0001H     A   
AR2 . . . . . . . . . . .  D  ADDR  0002H     A   
AR3 . . . . . . . . . . .  D  ADDR  0003H     A   
AR4 . . . . . . . . . . .  D  ADDR  0004H     A   
AR5 . . . . . . . . . . .  D  ADDR  0005H     A   
AR6 . . . . . . . . . . .  D  ADDR  0006H     A   
AR7 . . . . . . . . . . .  D  ADDR  0007H     A   
B . . . . . . . . . . . .  D  ADDR  00F0H     A   
B_ACTIVE. . . . . . . . .  N  NUMB  0005H     A   
B_IVL . . . . . . . . . .  N  NUMB  0007H     A   
B_RDY . . . . . . . . . .  N  NUMB  0007H     A   
B_READY . . . . . . . . .  N  NUMB  0004H     A   
B_ROBIN . . . . . . . . .  N  NUMB  0006H     A   
B_SIGNAL. . . . . . . . .  N  NUMB  0002H     A   
B_TIMEOUT . . . . . . . .  N  NUMB  0003H     A   
B_WAITSIG . . . . . . . .  N  NUMB  0000H     A   
B_WAITTIM . . . . . . . .  N  NUMB  0001H     A   
CONT_TIMINT . . . . . . .  C  ADDR  0012H     R   SEG=?RTX?CODE
CPU_IDLE_CODE . . . . . .  N  NUMB  0000H     A   
CheckRobinTime. . . . . .  C  ADDR  004FH     R   SEG=?RTX?CODE
DPH . . . . . . . . . . .  D  ADDR  0083H     A   
DPL . . . . . . . . . . .  D  ADDR  0082H     A   
EA. . . . . . . . . . . .  B  ADDR  00A8H.7   A   
FREE_STACK. . . . . . . .  N  NUMB  0014H     A   
AX51 MACRO ASSEMBLER  RTX51_CONFIG                                                          06/25/14 11:19:22 PAGE    12

HW_TIMER. . . . . . . . .  C  ADDR  0004H     R   SEG=?RTX?CODE
IE. . . . . . . . . . . .  D  ADDR  00A8H     A   
INT_REGBANK . . . . . . .  N  NUMB  0001H     A   
K_ACTIVE. . . . . . . . .  N  NUMB  0020H     A   
K_IVL . . . . . . . . . .  N  NUMB  0080H     A   
K_RDY . . . . . . . . . .  N  NUMB  0080H     A   
K_READY . . . . . . . . .  N  NUMB  0010H     A   
K_ROBIN . . . . . . . . .  N  NUMB  0040H     A   
K_SIG . . . . . . . . . .  N  NUMB  0001H     A   
K_TMO . . . . . . . . . .  N  NUMB  0002H     A   
LONG_USR_INTR . . . . . .  N  NUMB  0001H     A   
NoEvent . . . . . . . . .  C  ADDR  0108H     R   SEG=?RTX?CODE
NoRobinTimeout. . . . . .  C  ADDR  004EH     R   SEG=?RTX?CODE
NoTimeout . . . . . . . .  C  ADDR  0045H     R   SEG=?RTX?CODE
NoWaitTimeout . . . . . .  C  ADDR  0043H     R   SEG=?RTX?CODE
PSW . . . . . . . . . . .  D  ADDR  00D0H     A   
RAMTOP. . . . . . . . . .  N  NUMB  00FFH     A   
RDY_EVENT . . . . . . . .  N  NUMB  0080H     A   
RobinOn . . . . . . . . .  C  ADDR  0114H     R   SEG=?RTX?CODE
SIG_EVENT . . . . . . . .  N  NUMB  0004H     A   
SP. . . . . . . . . . . .  D  ADDR  0081H     A   
SignalOff . . . . . . . .  C  ADDR  00FCH     R   SEG=?RTX?CODE
SignalOn. . . . . . . . .  C  ADDR  0108H     R   SEG=?RTX?CODE
TIMERINT. . . . . . . . .  C  ADDR  0005H     R   SEG=?RTX?CODE
TIMERLOOP . . . . . . . .  C  ADDR  0035H     R   SEG=?RTX?CODE
TIMESHARING . . . . . . .  N  NUMB  0005H     A   
TMO_EVENT . . . . . . . .  N  NUMB  0008H     A   
TaskState . . . . . . . .  I  ADDR  0001H     R   SEG=?RTX?TASKSTATE?S
TimeOutOn . . . . . . . .  C  ADDR  0104H     R   SEG=?RTX?CODE
TimerVal. . . . . . . . .  I  ADDR  0000H     R   SEG=?RTX?TASKSTATE?S
checkstack. . . . . . . .  C  ADDR  0029H     R   SEG=?RTX?CODE
currenttask . . . . . . .     REG   R„            
main. . . . . . . . . . .  C  ADDR  0134H     R   SEG=?RTX?CODE
main1 . . . . . . . . . .  C  ADDR  013DH     R   SEG=?RTX?CODE
main1x. . . . . . . . . .  C  ADDR  0147H     R   SEG=?RTX?CODE
main2 . . . . . . . . . .  C  ADDR  0142H     R   SEG=?RTX?CODE
os_switch_task. . . . . .  C  ADDR  007AH     R   SEG=?RTX?CODE
os_switch_task1 . . . . .  C  ADDR  007AH     R   SEG=?RTX?CODE
robintime . . . . . . . .     REG   R…            
saveacc . . . . . . . . .     REG   R‚            
savepsw . . . . . . . . .     REG   Rƒ            


REGISTER BANK(S) USED: 0 


ASSEMBLY COMPLETE.  0 WARNING(S), 0 ERROR(S).
